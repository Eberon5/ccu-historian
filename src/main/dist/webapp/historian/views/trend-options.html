<%
def log=request.getAttribute('log')
def trendOptions=request.getAttribute('trendOptions')
def selectedDataPoints=request.getAttribute('dataPoints')

log.trace 'Trend options: {}', trendOptions

def groupHeightPresets=[1, 2, 5, 10, 20, 50]

html.input(type:'hidden', name:'w', value:trendOptions.width)
html.input(type:'hidden', name:'h', value:trendOptions.height)
html.input(type:'hidden', name:'t', value:trendOptions.trendDesign.identifier)

def dataPointToGroupIdx=[:]
trendOptions.groups.eachWithIndex { group, idx ->
	group.dataPoints.each { dp ->
		dataPointToGroupIdx[dp.idx]=idx
	}
}
selectedDataPoints.each { dp ->
	def groupIdx=dataPointToGroupIdx[dp.idx]?:0
	html.input(type:'hidden', name:'g', value:groupIdx)
} 

html.table {
	tr {
		th 'Gruppenhöhen:'
		5.times { groupIdx ->
			th "Gruppe ${groupIdx+1}:"
			td {
				def groupHeight=(groupIdx < trendOptions.groups.size())?trendOptions.groups[groupIdx].height:-1
				select(name:'gh', size:1) {
					groupHeightPresets.each { height ->
						option( (groupHeight==height)?[selected:'selected']:[:], height)
					}								
					if (groupHeight==-1) {
						option(value:1, selected:'selected', '---')
					}
				}
			}
		}
	}
	tr {
		td {
			input type:'submit', value:' Änderungen übernehmen '
		}
	}
}
%>